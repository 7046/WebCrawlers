#mporting base64 library because we'll need it ONLY in case if the proxy we are going to use requires authentication
import base64
import random
# Start your middleware class
class ProxyMiddleware(object):
    # overwrite process request
    def process_request(self, request, spider):
        # Set the location of the proxy
        user_agent_ip_list = [
            "http://58.242.248.5:80",
            "http://183.148.18.57:9529",
            "http://183.91.33.44:8081",
            "http://27.46.30.242:8118",
            "http://223.12.12.116:81",
            "http://183.91.33.43:82",
            "http://183.139.154.24:8080",
            "http://223.95.105.204:80",
            "http://182.89.28.217:9529",
            "http://117.81.119.219:8118",
            "http://112.84.216.90:81",
            "http://123.119.27.67:8118",
            "http://112.251.227.89:81",
            "http://183.91.33.43:85",
            "http://183.91.33.43:8090",
            "http://183.91.33.44:88",
            "http://183.91.33.42:86",
            "http://183.91.33.76:89",
            "http://39.77.202.90:8080",
            "http://39.67.86.144:81",
            "http://119.183.175.141:81",
            "http://111.0.142.254:8888",
            "http://183.13.33.37:3128",
            "http://61.131.72.186:81",
            "http://183.91.33.42:8083",
            "http://113.229.171.59:8998",
            "http://183.91.33.42:87",
            "http://183.91.33.43:91",
            "http://114.36.76.182:8088",
            "http://183.91.33.44:8088",
            "http://183.91.33.41:81",
            "http://183.91.33.43:8081",
            "http://36.224.208.6:8080",
            "http://183.91.33.43:89",
            "http://119.29.189.202:8080",
            "http://183.91.33.44:91",
            "http://222.140.59.36:8090",
            "http://183.91.33.41:84",
            "http://119.137.127.41:3128",
            "http://183.91.33.76:84",
            "http://106.35.103.195:8888",
            "http://58.253.219.235:80",
            "http://183.91.33.44:81",
            "http://113.236.250.47:8998",
            "http://183.91.33.41:8081",
            "http://123.207.3.203:443",
            "http://14.211.217.133:8888",
            "http://218.66.36.4:80",
            "http://153.36.176.27:8888",
            "http://183.91.33.43:84",
            "http://60.22.79.233:8118",
            "http://183.91.33.76:8081",
            "http://113.10.158.14:8080",
            "http://117.28.117.207:8118",
            "http://59.49.86.202:8080",
            "http://27.153.32.28:81",
            "http://60.20.119.25:80",
            "http://123.147.89.45:80",
            "http://1.193.68.208:3128",
            "http://171.126.37.138:8888",
            "http://125.115.81.42:8998",
            "http://183.91.33.44:90",
            "http://223.11.205.171:81",
            "http://36.35.64.54:8088",
            "http://110.178.173.186:80",
            "http://183.91.33.44:8087",
            "http://183.91.33.44:89",
            "http://171.11.39.69:80",
            "http://138.19.41.253:80",
            "http://27.151.220.210:8888",
            "http://120.84.223.41:8888",
            "http://112.249.237.187:81",
            "http://112.84.73.133:81",
            "http://60.7.251.251:8888",
            "http://115.211.234.120:8888",
            "http://183.91.33.43:8089",
            "http://183.91.33.43:8080",
            "http://115.201.0.231:81",
            "http://124.164.152.244:8888",
            "http://183.91.33.44:84",
            "http://153.99.28.53:81",
            "http://119.185.56.131:81",
            "http://110.182.133.243:8998",
            "http://113.24.111.14:8118",
            "http://61.144.112.151:8888",
            "http://171.90.223.14:81",
            "http://59.57.198.44:81",
            "http://183.91.33.43:80",
            "http://120.236.138.27:8118",
            "http://123.65.159.120:8888",
            "http://112.83.235.204:8888",
            "http://27.156.79.49:8888",
            "http://183.91.33.44:86",
            "http://112.84.72.75:81",
            "http://119.29.57.93:8080",
            "http://220.78.198.137:80",
            "http://123.53.20.149:8888",
            "http://113.72.99.234:81",
            "http://106.75.198.201:443",
            "http://183.91.33.41:92",
            "http://119.120.125.111:8888",
            "http://183.91.33.41:85",
            "http://61.154.216.215:81",
            "http://116.19.17.127:8888",
            "http://113.70.93.120:81",
            "http://183.91.33.41:8083",
            "http://183.23.70.208:81",
            "http://183.230.53.193:8123",
            "http://125.127.166.166:81",
            "http://14.216.145.176:8888",
            "http://14.112.86.72:81",
            "http://61.145.241.59:8888",
            "http://59.40.95.164:3128",
            "http://183.91.33.41:8087",
            "http://113.103.84.112:81",
            "http://153.99.26.230:81",
            "http://182.89.7.54:8118",
            "http://113.70.101.230:81",
            "http://183.111.169.202:3128",
            "http://183.91.33.76:86",
            "http://113.73.210.111:8118",
            "http://183.91.33.76:8084",
            "http://61.216.77.127:8080",
            "http://106.4.1.30:8088",
            "http://182.89.5.57:8118",
            "http://113.69.155.68:81",
            "http://120.42.9.254:8888",
            "http://183.31.49.223:8888",
            "http://58.252.29.198:8118",
            "http://119.120.5.19:81",
            "http://183.91.33.41:8089",
            "http://113.195.249.164:81",
            "http://183.91.33.41:8084",
            "http://183.91.33.42:92"
        ]
        #request.meta['proxy'] = "http://115.223.107.52:81"

        proxy_ip = random.choice(user_agent_ip_list)
        print proxy_ip
        request.meta['proxy'] = proxy_ip

        proxy_user_pass = "2476371236@qq.com:luyi123"

        encoded_user_pass = base64.encodestring(proxy_user_pass)
        #print encoded_user_pass
        request.headers['Proxy-Authorization'] = 'Basic ' + encoded_user_pass

        # Set the location of the proxy
        #proxy_ip = random.choice(self.user_agent_ip_list)
        #request.meta['proxy'] = proxy_ip
        print '+'*8, 'the Current ip address is', proxy_ip, '+'*8

    # ip from http://pachong.org/
